# Cleaning Service

## Описание
Cleaning Service — микросервис для управления процессом очистки самолётов. Модуль предназначен для автоматического управления очисткой салона и заправкой воды самолёта после высадки пассажиров. Сервис работает параллельно с модулем кейтеринга.

## Основные функции

- Приём запросов на очистку самолёта, содержащих:
  - **AircraftId** — Идентификатор самолёта.
  - **NodeId** — Идентификатор узла, к которому должен подъехать транспорт.
  - **WaterAmount** — Необходимое количество воды.

- Автоматическое распределение задач между транспортными средствами с учетом следующих ограничений:
  - **Общее ограничение:** Максимум 5 машин одновременно.
  - **Ограничение на рейс:** Максимум 2 машины одновременно на один самолёт.

- Если в данный момент доступных машин недостаточно, запросы автоматически встают в очередь и выполняются при появлении свободного транспорта.

- Интерфейс администратора:
  - Возможность управления режимом работы (Mock или Real).
  - Настройка вместимости транспортных средств.
  - Формирование тестовых запросов.
  - Просмотр текущего состояния машин и очередей в реальном времени.

## Запуск приложения

### Предварительные требования
- .NET 6 SDK или новее
- Современный браузер

### Запуск приложения

```bash
# Клонирование репозитория
git clone https://github.com/reaport/cleaning.git
cd CleaningService

# Сборка проекта
dotnet build

# Запуск приложения
dotnet run
```

После запуска откройте браузер по адресу:

```
https://localhost:5001/Admin/Index
```

## Использование API

### Запрос на очистку

- **URL:** `POST /request`
- **Тело запроса:**

```json
{
  "AircraftId": "ABC123",
  "NodeId": "NODE_1",
  "WaterAmount": 300
}
```

### Ответы API

- **Успешный ответ (200):**

```json
{
  "wait": true
}
```

- **Ошибка (400) при некорректных данных:**

```json
{
  "errorCode": 100,
  "message": "AircraftId is required"
}
```

- **Ошибка (500) внутренняя ошибка:**

```json
{
  "errorCode": 500,
  "message": "InternalServerError"
}
```

## Веб-интерфейс администратора

### Возможности

- Переключение между Mock и Real режимами.
- Обновление максимальной вместимости транспортных средств.
- Удобная форма отправки тестовых запросов очистки.
- Просмотр статуса транспортных средств и очереди в режиме реального времени.

### Ограничения

- **Общий лимит машин:** не более 5.
- **Максимум на один самолёт:** не более 2 машин.
- При превышении лимита запросы ставятся в очередь и выполняются, когда транспорт освободится.

## Логирование

Все операции логируются с помощью встроенных инструментов .NET, что позволяет отслеживать процессы, ошибки и другие события в системе.

